<div class="bloc-index">




  <div class="index-top">


    <div class="container">
      <div class="row">
        <div class="col-md-10">




        <h3>Below is a listing of all available blox part of the Weblox project. Add your favorite blox to your bucket and use them to build your next webpage!</h3>
        </div>
      </div>
    </div>
  </div>
  <div class="polygon-divider" width="300" height="200"></div>

  <!-- data-isotope-options='{"itemSelector": ".item" }' -->

  <div class=" bloc-listing">
    <div id="box" class=" js-isotope" >

      <% @blocs.each do |bloc| %>
        <% builder = @users.find(bloc.user_id) %>
        <div class="item">
            <div class="item-content">
                <!-- <img class="img-responsive" src="<%= bloc.bloc_img.url %>" title="<%= bloc.id %>-<%= bloc.name %>"> -->
                <%= link_to bloc_path(bloc), id: "show-iframe-"+bloc.id.to_s, class: "iframe-container" do %>
                  <div class="glasspanel" height="2" width="2"></div>
                  <textarea id="code-<%=bloc.id%>" class="hidden"><%= raw bloc.code %></textarea>
                  <textarea id="styles-<%=bloc.id%>" class="hidden"><%= raw bloc.styles %></textarea>
                  <iframe id="iframe-<%=bloc.id%>" class="bloc-iframe" height="2"></iframe>

                <% end %>
              <div class="bloc-info">
                <%= link_to bloc_path(bloc), class: "bloc-info-name" do %>
                  <%= bloc.name %>
                <% end %>

                <% if !current_user.bucket_blocs.where(:bloc_id => bloc.id).present? %>
                  <%= link_to bucket_blocs_path(:user => current_user, :bloc => bloc), class: "add-to-bucket" ,method: :post do %>
                  <i class="fa fa-plus"></i>
                  <% end %>
                <% end %>

                <script>
                $(window).bind("load", function(){
                  var contents = $('#iframe-<%=bloc.id%>').contents(),
                  body = contents.find('body'),
                  headerTag = $(returnHeaderTag()).appendTo(contents.find('head')),
                  styleTag = $('<style></style>').appendTo(contents.find('head'));
                  styleTag.text($('#styles-<%= bloc.id %>').val());
                  body.html($('#code-<%= bloc.id %>').val());
                  updateIframeSize('iframe-<%=bloc.id%>');
                  updateContainerSize('<%=bloc.id%>', 0.2175);
                });
                </script>


              </div>
            </div>
            <div class="bloc-builder">
                  <% if builder.avatar_url.present? %>
                    <%= image_tag builder.avatar_url, class: "img-circle" %>
                  <% else %>
                    <%= image_tag gravatar_url(builder), class: "img-circle" %>
                  <% end %>
                  <%= link_to builder.profile.handle, profile_path(builder.profile.id), class: "builder-profile" %>
                </div>
        </div>
      <% end %>

    </div>
  </div>

  <%= form_tag(blocs_path, :method => "get", class: "navbar-form",id: "search-form") do %>
    <div class="input-append">

      <%= text_field_tag :search, params[:search], class: "form-control", placeholder: "Search Tags" %>
      <input type="submit" class="btn btn-primary"></input>
       <%= link_to "reset", blocs_path, class: "btn btn-primary" %>
    </div>
     
  <% end %>

  <%= link_to 'New Bloc', new_bloc_path %>

</div>




<script>
$(window).bind("load", function(){
  
  $('.js-isotope').isotope({
    itemSelector: '.item',
    masonry: {
      columnWidth: 285
    }
  });

});
</script>